/*!
 * angular-incremental-list
 * @see https://github.com/tfoxy/angular-incremental-list
 * @version 0.4.0
 * @author Tom√°s Fox <tomas.c.fox@gmail.com>
 * @license MIT
 */
!function(){"use strict";function e(){return{restrict:"A",priority:v,controller:f,link:function(e,t,i,n){n.postInitialize()}}}function t(){return{restrict:"A",require:"ilList",link:{pre:function(e,t,i,n){var r=e.$index;if("number"!=typeof r)throw new Error("scope.$index is not a number. Got: "+r);n.scopeCreatedAt(r,e)}}}}function i(){return{restrict:"A",require:["^ilList","ngModel"],link:function(e,t,i,n){var r=n[0],o=n[1],u=i.ilItemModel?e.$eval(i.ilItemModel):e,c=function(){r.listItemChanged(u.$index,o)};o.$viewChangeListeners.push(c),m(u.$$ilListModels,o,e),r.listenToEvents(u,t,c)}}}function n(){return{restrict:"A",require:"ilList",priority:h,link:function(e,t,i,n){n.createItem=function(){return n.evalWithCurrentScope(i.ilNewItem)}}}}function r(){return{restrict:"A",require:"ilList",priority:h,link:function(e,t,i,n){n.mustIncrement=function(){return n.evalWithCurrentScope(i.ilIncreaseOn)}}}}function o(){return{restrict:"A",require:"ilList",priority:h,link:function(e,t,i,n){n.mustDecrement=function(){return n.evalWithCurrentScope(i.ilDecreaseOn)}}}}function u(){return{restrict:"A",require:["^^ilList","ilList"],priority:h,link:function(e,t,i,n){var r=n[0],o=n[1];o.notifyParentList=function(e,t){var n=i.ilListModel?e.$eval(i.ilListModel):e.$parent;r.listItemChanged(n.$index,t)},m(e.$$ilListChildCtrls,o,e)}}}function c(){return{restrict:"A",require:"ilList",priority:h,link:function(e,t,i,n){var r=parseInt(i.ilMinLength);n.minLength=r>0?r:0}}}function l(){return{restrict:"A",require:"ilList",priority:h,link:function(e,t,i,n){var r=parseInt(i.ilMaxLength);n.maxLength=r>0?r:0}}}function s(e){function t(t,i,n,r){r.listenToEvents=function(t,i,n){i.on("focus",function(){r.cancelBlurTimeout(),r.focusIndex=t.$index,r.blurListener&&(t.$apply(r.blurListener),r.blurListener=null),t.$apply(n)}),i.on("blur",function(){r.blurListener=n,r.blurTimeout=e(function(){r.blurTimeout=null,r.focusIndex=-1,r.blurListener=null,n()})})}}return{restrict:"A",require:"ilList",priority:h,link:t}}function a(){return{restrict:"A",require:"ilList",priority:h,link:function(e,t,i,n){n.enableMiddleDecrease()}}}function f(e,t,i){function n(){var e=A.list;if(angular.isUndefined(e)||null===e)throw Error("ilList is "+e+": "+t.ilList)}function r(){A.blurTimeout&&(i.cancel(A.blurTimeout),A.blurTimeout=null)}function o(e,t){if("number"!=typeof e)throw new Error("scope.$index is not a number. Got: "+e);var i=A.list.length,n=c(e);M.currentScope=n,M.changed=t,e===i-1&&i<A.maxLength?a():e===i-2&&i>A.minLength?f():i>A.minLength&&A.checkDecreaseConditions(),delete M.currentScope,delete M.changed,A.notifyParentList(n,t)}function u(){function e(){m(M.currentScope)}A.checkDecreaseConditions=e}function c(e){return e>=A.list.length||0>e?null:A.list[e][L]}function l(e){return c(e.$index-1)}function s(e){return c(e.$index+1)}function a(){A.mustIncrement()?A.list.push(A.createItem()):M.currentScope.$first||f()}function f(){var e=M.currentScope,t=e.$last?l(e):s(e);A.mustDecrement()&&p(t)&&(e.$last||A.list.pop(),m(l(e)))}function p(e){return M.currentScope=e,A.mustDecrement()}function m(e){var t,i,n=A.minLength-1,r=e;for(t=i=A.list.length-2;t>=n&&p(r);--t,r=l(r));A.list.splice(t+1,i-t)}function h(e){return M.currentScope.$eval(e,S)}function v(){return{}}function $(){return A.focusIndex===M.currentScope.$index}function g(){var t=A.list.length,i=c(t-1)||e;if(t<A.minLength){var n=new d(A.minLength-t,A,I);A.scopeCreatedAt=n.scopeCreatedAt.bind(n),n.pushItem(i)}else t>A.maxLength&&A.list.splice(A.maxLength,t-A.maxLength)}function I(e,t){var i=A.list[e];Object.defineProperty(i,L,{configurable:!0,enumerable:!1,value:t}),t.$$ilListModels=[],t.$$ilListChildCtrls=[],t.$on("$destroy",function(){delete i[L]})}function y(e,t){function i(t){var r=t||M.currentScope,o=r.$$ilListModels.every(function(t){return e^!x(t[n])});return o?r.$$ilListChildCtrls.every(function(e){return e.list.every(function(e){return i(e[L])})}):!1}var n=t?"$modelValue":"$viewValue";return i}function C(){var e=M.changed.$modelValue;return x(e)}function x(e){return e||0===e}function b(){var e=M.changed.$viewValue;return x(e)}var A=this,M={emptyModel:y(!1,!0),emptyView:y(!1,!1),fullModel:y(!0,!0),fullView:y(!0,!1),hasFocus:$,modelExists:C,viewExists:b},S={$ilList:M};A.blurTimeout=null,A.cancelBlurTimeout=r,A.checkDecreaseConditions=angular.noop,A.createItem=v,A.enableMiddleDecrease=u,A.evalWithCurrentScope=h,A.focusIndex=-1,A.list=e.$eval(t.ilList),A.listenToEvents=angular.noop,A.listItemChanged=o,A.localScope=S,A.maxLength=9007199254740991,A.minLength=1,A.mustDecrement=M.emptyView,A.mustIncrement=C,A.notifyParentList=angular.noop,A.postInitialize=g,A.scopeCreatedAt=I,n()}function d(e,t,i){this._countdown=e,this._vm=t,this._scopeCreatedAt=i}function p(e,t){var i=e.indexOf(t);i>=0&&e.splice(i,1)}function m(e,t,i){e.push(t),i.$on("$destroy",function(){p(e,i)})}var h=2e3,v=3e3,L="$$ilListScope";angular.module("incrementalList",[]).directive("ilList",e).directive("ilList",t).directive("ilItemModel",i).directive("ilNewItem",n).directive("ilIncreaseOn",r).directive("ilDecreaseOn",o).directive("ilListModel",u).directive("ilMinLength",c).directive("ilMaxLength",l).directive("ilEnableHasFocus",s).directive("ilDecreaseMiddle",a),s.$inject=["$timeout"],f.$inject=["$scope","$attrs","$timeout"],d.prototype.pushItem=function(e){this._vm.localScope.$ilList.currentScope=e,this._vm.list.push(this._vm.createItem()),--this._countdown<=0&&(this._vm.scopeCreatedAt=this._scopeCreatedAt),delete this._vm.localScope.$ilList.currentScope},d.prototype.scopeCreatedAt=function(e,t){this._scopeCreatedAt(e,t),this.pushItem(t)}}();